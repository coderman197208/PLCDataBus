<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC Timing Diagram</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="plot" style="width:100%;height:800px;"></div>
    <script>
        let data = {
            clock_2Hz: { x: [], y: [], mode: 'lines', name: '2Hz' },
            clock_1Hz: { x: [], y: [], mode: 'lines', name: '1Hz' },
            clock_0_5Hz: { x: [], y: [], mode: 'lines', name: '0.5Hz' }
        };

        let layout = {
            title: 'PLC Timing Diagram',
            xaxis: { title: 'Time (250ms intervals)' },
            yaxis: { title: 'Signal Value' }
        };

        let config = { responsive: true };

        // 初始化图表
        Plotly.newPlot('plot', Object.values(data), layout, config);

        // 定时更新图表
        setInterval(() => {
            fetch('data.json')
                .then(response => response.json())
                .then(json => {
                    // 清空旧数据
                    for (let key in data) {
                        data[key].x = [];
                        data[key].y = [];
                    }

                    // 填充新数据
                    json.forEach((entry, index) => {
                        for (let key in data) {
                            data[key].x.push(index * 0.25); // 时间轴（250ms间隔）
                            data[key].y.push(entry[key]);
                        }
                    });

                    // 更新图表
                    Plotly.update('plot', Object.values(data), layout);
                })
                .catch(error => console.error('Error fetching data:', error));
        }, 250); // 每250ms更新一次
    </script>
</body>
</html>